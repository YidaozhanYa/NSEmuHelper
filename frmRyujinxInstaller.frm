VERSION 5.00
Object = "{831FDD16-0C5C-11D2-A9FC-0000F8754DA1}#2.0#0"; "MSCOMCTL.OCX"
Object = "{48E59290-9880-11CF-9754-00AA00C00908}#1.0#0"; "MSINET.OCX"
Object = "{A5E8A7E4-5CB9-46EB-8987-15503F7E5563}#34.0#0"; "YFUI.ocx"
Begin VB.Form frmRyujinxInstaller 
   BackColor       =   &H80000005&
   BorderStyle     =   1  'Fixed Single
   Caption         =   "°²×° Ryujinx"
   ClientHeight    =   5085
   ClientLeft      =   5625
   ClientTop       =   4485
   ClientWidth     =   8760
   BeginProperty Font 
      Name            =   "Î¢ÈíÑÅºÚ Light"
      Size            =   12
      Charset         =   134
      Weight          =   290
      Underline       =   0   'False
      Italic          =   0   'False
      Strikethrough   =   0   'False
   EndProperty
   Icon            =   "frmRyujinxInstaller.frx":0000
   LinkTopic       =   "Form1"
   MaxButton       =   0   'False
   MinButton       =   0   'False
   ScaleHeight     =   5085
   ScaleWidth      =   8760
   Begin YFUI.YFProgressBar PBar 
      Height          =   300
      Left            =   120
      Top             =   3480
      Visible         =   0   'False
      Width           =   8415
      _ExtentX        =   14843
      _ExtentY        =   529
      BarFullColor    =   16761716
      Radius          =   3
   End
   Begin YFUI.YFOptionButton opFirmware 
      Height          =   375
      Index           =   0
      Left            =   1440
      TabIndex        =   11
      Top             =   2520
      Width           =   1455
      _ExtentX        =   2566
      _ExtentY        =   661
      Caption         =   "±¾µØÑ¡Ôñ"
      BeginProperty Font {0BE35203-8F91-11CE-9DE3-00AA004BB851} 
         Name            =   "Î¢ÈíÑÅºÚ Light"
         Size            =   12
         Charset         =   134
         Weight          =   290
         Underline       =   0   'False
         Italic          =   0   'False
         Strikethrough   =   0   'False
      EndProperty
      DownColor       =   16185594
      DownBorderColor =   14014426
      DownSelBorderColor=   14014426
      FocusColor      =   16755285
      FocusBorderColor=   14014426
      FocusSelBorderColor=   16761716
      EnabledColor    =   16755285
      EnabledBorderColor=   14014426
      EnabledSelBorderColor=   16761716
      HighColor       =   16761716
      HighBorderColor =   15132905
      HighSelBorderColor=   16761716
      Value           =   -1  'True
   End
   Begin InetCtlsObjects.Inet Inet1 
      Left            =   840
      Top             =   4320
      _ExtentX        =   1005
      _ExtentY        =   1005
      _Version        =   393216
   End
   Begin NSEmuHelper.ucDownload ucDownload1 
      Height          =   255
      Left            =   0
      TabIndex        =   6
      Top             =   4800
      Width           =   615
      _ExtentX        =   1085
      _ExtentY        =   450
   End
   Begin MSComctlLib.ImageList ImageList2 
      Left            =   6120
      Top             =   3840
      _ExtentX        =   1005
      _ExtentY        =   1005
      BackColor       =   -2147483643
      ImageWidth      =   128
      ImageHeight     =   128
      MaskColor       =   12632256
      _Version        =   393216
      BeginProperty Images {2C247F25-8591-11D1-B16A-00C0F0283628} 
         NumListImages   =   2
         BeginProperty ListImage1 {2C247F27-8591-11D1-B16A-00C0F0283628} 
            Picture         =   "frmRyujinxInstaller.frx":54AA
            Key             =   ""
         EndProperty
         BeginProperty ListImage2 {2C247F27-8591-11D1-B16A-00C0F0283628} 
            Picture         =   "frmRyujinxInstaller.frx":5F8B
            Key             =   ""
         EndProperty
      EndProperty
   End
   Begin MSComctlLib.ImageList ImageList1 
      Left            =   7320
      Top             =   1320
      _ExtentX        =   1005
      _ExtentY        =   1005
      BackColor       =   -2147483643
      ImageWidth      =   72
      ImageHeight     =   72
      MaskColor       =   12632256
      _Version        =   393216
      BeginProperty Images {2C247F25-8591-11D1-B16A-00C0F0283628} 
         NumListImages   =   2
         BeginProperty ListImage1 {2C247F27-8591-11D1-B16A-00C0F0283628} 
            Picture         =   "frmRyujinxInstaller.frx":7163
            Key             =   ""
         EndProperty
         BeginProperty ListImage2 {2C247F27-8591-11D1-B16A-00C0F0283628} 
            Picture         =   "frmRyujinxInstaller.frx":C61D
            Key             =   ""
         EndProperty
      EndProperty
   End
   Begin YFUI.YFButton btnShortcut 
      Height          =   495
      Left            =   240
      TabIndex        =   7
      Tag             =   "T"
      Top             =   4320
      Width           =   2775
      _ExtentX        =   4895
      _ExtentY        =   873
      Caption         =   "´´½¨×ÀÃæ¿ì½Ý·½Ê½"
      BeginProperty Font {0BE35203-8F91-11CE-9DE3-00AA004BB851} 
         Name            =   "Î¢ÈíÑÅºÚ Light"
         Size            =   12
         Charset         =   134
         Weight          =   290
         Underline       =   0   'False
         Italic          =   0   'False
         Strikethrough   =   0   'False
      EndProperty
      ForeColor       =   2039583
      DownColor       =   16185594
      DownBorderColor =   14014426
      FocusColor      =   16185594
      FocusBorderColor=   13882840
      EnabledColor    =   16185594
      EnabledBorderColor=   14014426
      DisabledBorderColor=   14014426
      HighColor       =   15988473
      HighBorderColor =   15132905
      Radius          =   3
      Data            =   "frmRyujinxInstaller.frx":324B7
   End
   Begin YFUI.YFButton btnDelYes 
      Height          =   495
      Left            =   5160
      TabIndex        =   8
      Tag             =   "T"
      Top             =   4320
      Width           =   1455
      _ExtentX        =   2566
      _ExtentY        =   873
      Caption         =   "ÊÇ"
      BeginProperty Font {0BE35203-8F91-11CE-9DE3-00AA004BB851} 
         Name            =   "Î¢ÈíÑÅºÚ Light"
         Size            =   12
         Charset         =   134
         Weight          =   290
         Underline       =   0   'False
         Italic          =   0   'False
         Strikethrough   =   0   'False
      EndProperty
      ForeColor       =   2039583
      DownColor       =   16185594
      DownBorderColor =   14014426
      FocusColor      =   16185594
      FocusBorderColor=   13882840
      EnabledColor    =   16185594
      EnabledBorderColor=   14014426
      DisabledBorderColor=   14014426
      HighColor       =   15988473
      HighBorderColor =   15132905
      Radius          =   3
      Data            =   "frmRyujinxInstaller.frx":324CF
   End
   Begin YFUI.YFButton btnDelNo 
      Height          =   495
      Left            =   7080
      TabIndex        =   9
      Tag             =   "T"
      Top             =   4320
      Width           =   1455
      _ExtentX        =   2566
      _ExtentY        =   873
      Caption         =   "·ñ"
      BeginProperty Font {0BE35203-8F91-11CE-9DE3-00AA004BB851} 
         Name            =   "Î¢ÈíÑÅºÚ Light"
         Size            =   12
         Charset         =   134
         Weight          =   290
         Underline       =   0   'False
         Italic          =   0   'False
         Strikethrough   =   0   'False
      EndProperty
      ForeColor       =   2039583
      DownColor       =   16185594
      DownBorderColor =   14014426
      FocusColor      =   16185594
      FocusBorderColor=   13882840
      EnabledColor    =   16185594
      EnabledBorderColor=   14014426
      DisabledBorderColor=   14014426
      HighColor       =   15988473
      HighBorderColor =   15132905
      Radius          =   3
      Data            =   "frmRyujinxInstaller.frx":324E7
   End
   Begin YFUI.YFButton btnNextStep 
      Height          =   495
      Left            =   7080
      TabIndex        =   10
      Tag             =   "T"
      Top             =   4320
      Width           =   1455
      _ExtentX        =   2566
      _ExtentY        =   873
      Caption         =   "ÏÂÒ»²½"
      BeginProperty Font {0BE35203-8F91-11CE-9DE3-00AA004BB851} 
         Name            =   "Î¢ÈíÑÅºÚ Light"
         Size            =   12
         Charset         =   134
         Weight          =   290
         Underline       =   0   'False
         Italic          =   0   'False
         Strikethrough   =   0   'False
      EndProperty
      ForeColor       =   2039583
      DownColor       =   16185594
      DownBorderColor =   14014426
      FocusColor      =   16185594
      FocusBorderColor=   13882840
      EnabledColor    =   16185594
      EnabledBorderColor=   14014426
      DisabledBorderColor=   14014426
      HighColor       =   15988473
      HighBorderColor =   15132905
      Radius          =   3
      Data            =   "frmRyujinxInstaller.frx":324FF
   End
   Begin YFUI.YFOptionButton opFirmware 
      Height          =   375
      Index           =   1
      Left            =   1440
      TabIndex        =   12
      Top             =   3120
      Width           =   1455
      _ExtentX        =   2566
      _ExtentY        =   661
      Caption         =   "ÔÚÏßÏÂÔØ"
      BeginProperty Font {0BE35203-8F91-11CE-9DE3-00AA004BB851} 
         Name            =   "Î¢ÈíÑÅºÚ Light"
         Size            =   12
         Charset         =   134
         Weight          =   290
         Underline       =   0   'False
         Italic          =   0   'False
         Strikethrough   =   0   'False
      EndProperty
      DownColor       =   16185594
      DownBorderColor =   14014426
      DownSelBorderColor=   14014426
      FocusColor      =   16755285
      FocusBorderColor=   14014426
      FocusSelBorderColor=   16761716
      EnabledColor    =   16755285
      EnabledBorderColor=   14014426
      EnabledSelBorderColor=   16761716
      HighColor       =   16755285
      HighBorderColor =   15132905
      HighSelBorderColor=   16761716
   End
   Begin YFUI.YFButton btnBrowse 
      Height          =   375
      Left            =   7440
      TabIndex        =   13
      Tag             =   "T"
      Top             =   2520
      Width           =   1095
      _ExtentX        =   1931
      _ExtentY        =   661
      Caption         =   "ä¯ÀÀ"
      BeginProperty Font {0BE35203-8F91-11CE-9DE3-00AA004BB851} 
         Name            =   "Î¢ÈíÑÅºÚ Light"
         Size            =   12
         Charset         =   134
         Weight          =   290
         Underline       =   0   'False
         Italic          =   0   'False
         Strikethrough   =   0   'False
      EndProperty
      ForeColor       =   2039583
      DownColor       =   16185594
      DownBorderColor =   14014426
      FocusColor      =   16185594
      FocusBorderColor=   13882840
      EnabledColor    =   16185594
      EnabledBorderColor=   14014426
      DisabledBorderColor=   14014426
      HighColor       =   15988473
      HighBorderColor =   15132905
      Radius          =   3
      Data            =   "frmRyujinxInstaller.frx":32517
   End
   Begin YFUI.YFComboBox cbFirmware 
      Height          =   375
      Left            =   3240
      TabIndex        =   14
      Tag             =   "W"
      Top             =   3120
      Width           =   3975
      _ExtentX        =   7011
      _ExtentY        =   661
      BeginProperty Font {0BE35203-8F91-11CE-9DE3-00AA004BB851} 
         Name            =   "Î¢ÈíÑÅºÚ Light"
         Size            =   9
         Charset         =   134
         Weight          =   290
         Underline       =   0   'False
         Italic          =   0   'False
         Strikethrough   =   0   'False
      EndProperty
      ForeColor       =   2039583
      EnabledColor    =   14014426
      ItemFocusColor  =   14014426
      Radius          =   3
   End
   Begin YFUI.YFComboBox ComboVersion 
      Height          =   375
      Left            =   4080
      TabIndex        =   15
      Tag             =   "W"
      Top             =   2520
      Width           =   1695
      _ExtentX        =   2990
      _ExtentY        =   661
      BeginProperty Font {0BE35203-8F91-11CE-9DE3-00AA004BB851} 
         Name            =   "Î¢ÈíÑÅºÚ Light"
         Size            =   9
         Charset         =   134
         Weight          =   290
         Underline       =   0   'False
         Italic          =   0   'False
         Strikethrough   =   0   'False
      EndProperty
      ForeColor       =   2039583
      EnabledColor    =   14014426
      ItemFocusColor  =   14014426
      Radius          =   3
   End
   Begin YFUI.YFTextBox txtFirmware 
      Height          =   375
      Left            =   3240
      TabIndex        =   16
      Tag             =   "W"
      Top             =   2520
      Width           =   3975
      _ExtentX        =   7011
      _ExtentY        =   661
      Tip             =   "<Çëµã»÷¡°ä¯ÀÀ¡±£¬Ö®ºóÔÚÏÂ·½Ñ¡Ôñ°æ±¾ºÅ>"
      BeginProperty Font {0BE35203-8F91-11CE-9DE3-00AA004BB851} 
         Name            =   "Î¢ÈíÑÅºÚ Light"
         Size            =   9
         Charset         =   134
         Weight          =   290
         Underline       =   0   'False
         Italic          =   0   'False
         Strikethrough   =   0   'False
      EndProperty
      ForeColor       =   2039583
      EnabledColor    =   14014426
      Radius          =   3
   End
   Begin YFUI.YFTextBox txtKey 
      Height          =   375
      Left            =   1560
      TabIndex        =   17
      Tag             =   "W"
      Top             =   2520
      Width           =   5655
      _ExtentX        =   9975
      _ExtentY        =   661
      Tip             =   "<Çëµã»÷¡°ä¯ÀÀ¡±>"
      BeginProperty Font {0BE35203-8F91-11CE-9DE3-00AA004BB851} 
         Name            =   "Î¢ÈíÑÅºÚ Light"
         Size            =   9
         Charset         =   134
         Weight          =   290
         Underline       =   0   'False
         Italic          =   0   'False
         Strikethrough   =   0   'False
      EndProperty
      ForeColor       =   2039583
      EnabledColor    =   14014426
      Radius          =   3
   End
   Begin YFUI.YFTextBox txtVersion 
      Height          =   375
      Left            =   4080
      TabIndex        =   18
      Tag             =   "W"
      Top             =   2520
      Width           =   1695
      _ExtentX        =   2990
      _ExtentY        =   661
      Tip             =   "¼ÓÔØÖÐ ..."
      BeginProperty Font {0BE35203-8F91-11CE-9DE3-00AA004BB851} 
         Name            =   "Î¢ÈíÑÅºÚ Light"
         Size            =   9
         Charset         =   134
         Weight          =   290
         Underline       =   0   'False
         Italic          =   0   'False
         Strikethrough   =   0   'False
      EndProperty
      ForeColor       =   2039583
      EnabledColor    =   14014426
      Radius          =   3
   End
   Begin YFUI.YFComboBox ImageCombo1 
      Height          =   375
      Left            =   2160
      TabIndex        =   19
      Tag             =   "W"
      Top             =   2520
      Width           =   1695
      _ExtentX        =   2990
      _ExtentY        =   661
      BeginProperty Font {0BE35203-8F91-11CE-9DE3-00AA004BB851} 
         Name            =   "Î¢ÈíÑÅºÚ Light"
         Size            =   9
         Charset         =   134
         Weight          =   290
         Underline       =   0   'False
         Italic          =   0   'False
         Strikethrough   =   0   'False
      EndProperty
      ForeColor       =   2039583
      EnabledColor    =   14014426
      ItemFocusColor  =   14014426
      Radius          =   3
   End
   Begin YFUI.YFButton btnVersionHelp 
      Height          =   375
      Left            =   6000
      TabIndex        =   20
      Tag             =   "T"
      Top             =   2520
      Width           =   375
      _ExtentX        =   661
      _ExtentY        =   661
      Caption         =   "?"
      BeginProperty Font {0BE35203-8F91-11CE-9DE3-00AA004BB851} 
         Name            =   "Î¢ÈíÑÅºÚ Light"
         Size            =   12
         Charset         =   134
         Weight          =   290
         Underline       =   0   'False
         Italic          =   0   'False
         Strikethrough   =   0   'False
      EndProperty
      ForeColor       =   2039583
      DownColor       =   16185594
      DownBorderColor =   14014426
      FocusColor      =   16185594
      FocusBorderColor=   13882840
      EnabledColor    =   16185594
      EnabledBorderColor=   14014426
      DisabledBorderColor=   14014426
      HighColor       =   15988473
      HighBorderColor =   15132905
      Radius          =   3
      Data            =   "frmRyujinxInstaller.frx":3252F
   End
   Begin VB.Image Image2 
      Height          =   375
      Left            =   1560
      Stretch         =   -1  'True
      Top             =   2520
      Width           =   375
   End
   Begin VB.Label Labels 
      BackStyle       =   0  'Transparent
      Caption         =   "indicator2"
      ForeColor       =   &H001F1F1F&
      Height          =   495
      Index           =   5
      Left            =   120
      TabIndex        =   5
      Top             =   2520
      Width           =   8415
   End
   Begin VB.Label Labels 
      BackStyle       =   0  'Transparent
      Caption         =   "indicator1"
      ForeColor       =   &H001F1F1F&
      Height          =   495
      Index           =   4
      Left            =   120
      TabIndex        =   4
      Top             =   1920
      Width           =   8415
   End
   Begin VB.Label Labels 
      BackStyle       =   0  'Transparent
      Caption         =   "Ä£ÄâÆ÷°æ±¾£º"
      ForeColor       =   &H001F1F1F&
      Height          =   495
      Index           =   3
      Left            =   120
      TabIndex        =   3
      Top             =   2520
      Width           =   2175
   End
   Begin VB.Label Labels 
      BackStyle       =   0  'Transparent
      Caption         =   "Steps"
      ForeColor       =   &H001F1F1F&
      Height          =   975
      Index           =   2
      Left            =   120
      TabIndex        =   2
      Top             =   1200
      Width           =   6615
   End
   Begin VB.Image Image1 
      Height          =   1215
      Left            =   7320
      Stretch         =   -1  'True
      Tag             =   "L"
      Top             =   240
      Width           =   1215
   End
   Begin VB.Label Labels 
      BackStyle       =   0  'Transparent
      Caption         =   "Steps"
      BeginProperty Font 
         Name            =   "Î¢ÈíÑÅºÚ Light"
         Size            =   15.75
         Charset         =   134
         Weight          =   290
         Underline       =   0   'False
         Italic          =   0   'False
         Strikethrough   =   0   'False
      EndProperty
      ForeColor       =   &H001F1F1F&
      Height          =   495
      Index           =   1
      Left            =   120
      TabIndex        =   1
      Top             =   600
      Width           =   6975
   End
   Begin VB.Label Labels 
      BackStyle       =   0  'Transparent
      Caption         =   "°²×° Ryujinx"
      ForeColor       =   &H001F1F1F&
      Height          =   495
      Index           =   0
      Left            =   120
      TabIndex        =   0
      Top             =   120
      Width           =   3735
   End
End
Attribute VB_Name = "frmRyujinxInstaller"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = False
Public DownloadCompleted As Boolean, TitlePrefix As String
'1£º´¿¾»°²×°
'2£º¸üÐÂÄ£ÄâÆ÷
'3£º¹Ì¼þ
Public iBranch As String, iVersion As String, iKeyPath As String, iFirmwareOnline As Boolean, iFirmwarePath As String, iFirmwareVersion As String
'1£º·ÖÖ§ True EA False Mainline
'2£º°æ±¾ºÅ
Public CurrentStep As Integer
Private Sub btnBrowse_Click()
    Debug.Print CurrentStep
    'ä¯ÀÀ
    Select Case CurrentStep
    Case 2
        txtKey.Text = ChooseFile("Ñ¡ÔñÃÜÔ¿ÎÄ¼þ (prod.keys)", "NS ÃÜÔ¿ÎÄ¼þ", "*.keys", frmRyujinxInstaller.hwnd)
    Case 3
        If opFirmware(0).Value Then
            txtFirmware.Text = ChooseFile("Ñ¡Ôñ¹Ì¼þ°ü (zip Ñ¹ËõÎÄ¼þ)", "NS ¹Ì¼þ°ü", "*.zip", frmRyujinxInstaller.hwnd)
            If txtFirmware.Text <> "" Then
                Dim TmpName As String
                TmpName = Split(txtFirmware.Text, "\")(UBound(Split(txtFirmware.Text, "\")))
                If InStr(TmpName, "Firmware ") <> 0 Then
                    cbFirmware.Text = Replace(Replace(TmpName, ".zip", ""), "Firmware ", "")
                ElseIf InStr(TmpName, "Firmware_") <> 0 Then
                    cbFirmware.Text = Replace(Replace(TmpName, ".zip", ""), "Firmware_", "")
                ElseIf InStr(TmpName, "registered-") <> 0 Then
                    cbFirmware.Text = Replace(Replace(TmpName, ".zip", ""), "registered-", "")
                End If
            End If
        End If
    Case Else
        Exit Sub
    End Select
End Sub


Private Sub btnNextStep_Click()
'ÏÂÒ»²½
    If InstallMode = 1 Then
        Select Case CurrentStep
        Case 1
            Step2
        Case 2
            Step3
        Case 3
            Step4
        Case Else
            Exit Sub
        End Select
    ElseIf InstallMode = 2 Then
        Step4
    ElseIf InstallMode = 3 Then
        Step4
    End If
End Sub

Private Sub btnShortcut_Click()
    Dim nPath As String, sh, ShortCut
    On Error Resume Next
    Set sh = CreateObject("wscript.shell")
    nPath = sh.RegRead("HKEY_CURRENT_USER\Software\Microsoft\Windows\CurrentVersion\Explorer\Shell Folders\Desktop")    '»ñÈ¡µ±Ç°ÓÃ»§µÄ×ÀÃæÄ¿Â¼
    If Right(nPath, 1) <> "" Then nPath = nPath & "\"
    ShortF = nPath & "Ryujinx.lnk"
    Set ShortCut = sh.CreateShortcut(ShortF)    '¿ªÊ¼´´½¨¿ì½Ý·½Ê½¶ÔÏó
    ShortCut.TargetPath = RyujinxInstallFolder & "\Ryujinx.exe"    '¿ì½Ý·½Ê½Ö¸ÏòµÄÄ¿±êÎÄ¼þ£¬Ð´ÍêÕûÂ·¾¶
    ShortCut.Save
    MsgBox "¿ì½Ý·½Ê½´´½¨³É¹¦£¡", vbOKOnly, "ÌáÊ¾"
End Sub

Private Sub btnVersionHelp_Click()
    MsgBox "Ö÷Ïß°æ£ºRyujinx ¹Ù·½·¢²¼µÄ°æ±¾£¬Î´¾­ÈÎºÎÐÞ¸Ä¡£" & vbCrLf & vbCrLf & _
           "ºº»¯°æ£ºÎÒ×ÔÖÆµÄºº»¯°æ±¾£¬ÓÉÖ÷Ïß°æÐÞ¸Ä¶øÀ´¡£" & vbCrLf & vbCrLf & _
           "LDN°æ£ºÔÚÍøÂçÖ§³Ö UPnP µÄÇé¿öÏÂ¿ÉÒÔÍæÐ¡²¿·ÖÁª»úÓÎÏ·¡£" & vbCrLf & vbCrLf & _
           "Vulkan°æ£ºÖ§³ÖVulkanäÖÈ¾Æ÷£¬AMD/IntelÏÔ¿¨ÍÆ¼öÊ¹ÓÃ¡£"
End Sub

Private Sub Form_Activate()
'¼ÓÔØ
    If InstallMode = 1 Then
        If RyujinxInstallFolder = "D:\Ryujinx" Then
            If MsgBox("µ±Ç°Ä£ÄâÆ÷°²×°Ä¿Â¼ÎªÄ¬ÈÏµÄ D:\Ryujinx£¬ÇëÈ·ÈÏÊÇ·ñ°²×°µ½´ËÎÄ¼þ¼Ð£¿" & vbCrLf & "µã¡°·ñ¡±ÒÔ»Øµ½Ö÷½çÃæ£¬µã»÷×óÏÂ½ÇµÄÉèÖÃ¸ü¸ÄÄ£ÄâÆ÷ÎÄ¼þ¼Ð¡£" & vbCrLf & "ÄãÒ²¿ÉÒÔ°ÑÄ£ÄâÆ÷ÎÄ¼þ¼ÐÉèÎªÄãÒÑ¾­×°ºÃµÄÄ£ÄâÆ÷Î»ÖÃ£¬³ÌÐò»á×Ô¶¯Ê¶±ð¡£", vbQuestion + vbYesNo, "È·ÈÏÂð£¿") = 7 Then
                frmMain.Show
                Unload Me
                Exit Sub
            End If
        End If
        TitlePrefix = "°²×° Ryujinx"
        Labels(0).Caption = TitlePrefix
        DoEvents
        CurrentStep = 1
        Step1
    ElseIf InstallMode = 2 Then
        TitlePrefix = "¸üÐÂ Ryujinx"
        Labels(0).Caption = TitlePrefix
        DoEvents
        CurrentStep = 1
        Step1
    ElseIf InstallMode = 3 Then
        TitlePrefix = "¸üÐÂ¹Ì¼þ"
        Labels(0).Caption = TitlePrefix
        DoEvents
        CurrentStep = 3
        Step3
    End If
    If InstallMode <> 1 Then RemoveTemps

End Sub

Private Sub Step1()
    On Error Resume Next
    'µÚÒ»²½
    '½çÃæ
    btnShortcut.Visible = False
    btnDelYes.Visible = False
    btnDelNo.Visible = False
    Labels(4).Visible = False
    Labels(5).Visible = False
    cbFirmware.Visible = False
    opFirmware(0).Visible = False
    opFirmware(1).Visible = False
    btnBrowse.Visible = False
    txtFirmware.Visible = False
    txtKey.Visible = False
    txtVersion.Visible = True
    btnVersionHelp.Visible = True
    ComboVersion.Visible = True
    Image1.Picture = ImageList2.ListImages(1).Picture
    Image2.Picture = ImageList2.ListImages(1).Picture
    If InstallMode = 1 Then
        Me.Caption = TitlePrefix & " - Step 1"
        Labels(1).Caption = "Step 1 - Ñ¡ÔñÄ£ÄâÆ÷°æ±¾"
        Labels(2).Caption = "ÔÚ°²×°Ä£ÄâÆ÷Ö®Ç°£¬ÄãÐèÒªÏÈ½øÐÐ¼¸²½Ñ¡Ôñ¡£" & vbCrLf & "¿ÉÒÔµã»÷ÏÂ·½ÎÊºÅ°´Å¥ÒÔ²é¿´¸÷¸ö·ÖÖ§°æ±¾Çø±ð¡£"
    Else
        Me.Caption = TitlePrefix
        Labels(1).Caption = "Ñ¡ÔñÄ£ÄâÆ÷°æ±¾"
        Labels(2).Caption = "ÇëÑ¡ÔñÒª¸ü»»µ½µÄÄ£ÄâÆ÷°æ±¾¡£" & vbCrLf & "¿ÉÒÔµã»÷ÏÂ·½ÎÊºÅ°´Å¥ÒÔ²é¿´¸÷¸ö·ÖÖ§°æ±¾Çø±ð¡£"
    End If
    Labels(3).Caption = "Ä£ÄâÆ÷°æ±¾£º"
    ImageCombo1.Clear
    ImageCombo1.AddItem "Ö÷Ïß°æ"
    ImageCombo1.AddItem "ÖÐÎÄ°æ"
    ImageCombo1.AddItem "LDNÁª»ú°æ"
    ImageCombo1.AddItem "Vulkan"
    ImageCombo1.Text = "Ö÷Ïß°æ"
    If DownloadSource = "GitHub" Then
        txtVersion.Visible = True
        ComboVersion.Visible = False
        txtVersion.Text = GetRyujinxVersion
        txtVersion.SetFocus
    Else
        txtVersion.Visible = False
        ComboVersion.Visible = True
        Dim RyujinxVersion() As String
        ComboVersion.Clear
        ComboVersion.Text = "¼ÓÔØÖÐ ..."
        RyujinxVersion = Split(GetRyujinxVersionAli, vbCrLf)
        Dim I As Integer
        For I = 0 To (UBound(RyujinxVersion) - LBound(RyujinxVersion))
            ComboVersion.AddItem RyujinxVersion(I)
            ComboVersion.Text = RyujinxVersion(I)
            ComboVersion.SetFocus
        Next
    End If
    'È·±£ÎÄ¼þ¼Ð´æÔÚ
    MkDirs RyujinxInstallFolder
End Sub

Private Sub Step2()
    On Error GoTo Step2Error
    iBranch = ImageCombo1.Text
    If DownloadSource = "GitHub" Then
        If txtVersion.Text = "¼ÓÔØÖÐ ..." Then Exit Sub
        iVersion = txtVersion.Text
    Else
        If ComboVersion.Text = "¼ÓÔØÖÐ ..." Then Exit Sub
        iVersion = ComboVersion.Text
    End If
    CurrentStep = 2
    'µÚ¶þ²½
    '½çÃæ
    Image2.Visible = False
    ImageCombo1.Visible = False
    txtVersion.Visible = False
    ComboVersion.Visible = False
    btnBrowse.Visible = True
    txtKey.Visible = True
    btnVersionHelp.Visible = False
    Me.Caption = TitlePrefix & " - Step 2"
    Labels(1).Caption = "Step 2 - Ñ¡ÔñÃÜÔ¿ÎÄ¼þ"
    Labels(2).Caption = "NS Ä£ÄâÆ÷ÐèÒªÃÜÔ¿ (Keys) ÎÄ¼þ²ÅÄÜÍæÓÎÏ·¡£" & vbCrLf & "Äã¿ÉÒÔÔÚÏà¹ØµÄÈºÖÐÕÒµ½Ëü (prod.keys)£¬²¢ÔÚÕâÀï´ò¿ª¡£"
    Labels(3).Caption = "ÃÜÔ¿ÎÄ¼þ£º"

    Exit Sub
Step2Error:
    ImageCombo1.Text = "Ö÷Ïß°æ"
    Image1.Picture = ImageList2.ListImages(1).Picture
    Image2.Picture = ImageList2.ListImages(1).Picture
    Exit Sub
End Sub

Private Sub Step3()
    If InstallMode = 1 Then
        If txtKey.Text = "<Çëµã»÷¡°ä¯ÀÀ¡±>" Or txtKey.Text = "" Then Exit Sub
        CurrentStep = 3
        'µÚÈý²½
        'ÉèÖÃµÚ¶þ²½½á¹û
        iKeyPath = txtKey.Text
        '½çÃæ
    End If
    Image2.Visible = False
    ComboVersion.Visible = False
    btnVersionHelp.Visible = False
    ImageCombo1.Visible = False
    btnShortcut.Visible = False
    btnDelYes.Visible = False
    btnDelNo.Visible = False
    Labels(4).Visible = False
    Labels(5).Visible = False
    cbFirmware.Visible = True
    btnBrowse.Visible = True
    cbFirmware.Visible = True
    txtKey.Visible = False
    txtFirmware.Visible = True
    opFirmware(0).Visible = True
    opFirmware(1).Visible = True
    If InstallMode = 1 Then
        Me.Caption = TitlePrefix & " - Step 3"
        Labels(1).Caption = "Step 3 - Ñ¡Ôñ¹Ì¼þ"
        Labels(2).Caption = "Ryujinx ÐèÒª¹Ì¼þ²ÅÄÜÍæÓÎÏ·¡£" & vbCrLf & "Äã¿ÉÒÔÔÚÏà¹ØµÄÈºÖÐÕÒµ½¹Ì¼þ°ü£¬»òÊ¹ÓÃ¡°ÔÚÏßÏÂÔØ¡±¡£" & vbCrLf & "¹Ì¼þ°æ±¾ÐèÒªÐ¡ÓÚµÈÓÚÃÜÔ¿°æ±¾¡£"
    ElseIf InstallMode = 3 Then
        If Left(RyujinxBranch, 3) = "LDN" Then
            Image1.Picture = ImageList2.ListImages(2).Picture
        Else
            Image1.Picture = ImageList2.ListImages(1).Picture
        End If
        Me.Caption = TitlePrefix & " - Ñ¡Ôñ¹Ì¼þ"
        Labels(1).Caption = "¸üÐÂ¹Ì¼þ°æ±¾"
        Labels(2).Caption = "Äã¿ÉÒÔÔÚ´Ë¸üÐÂ»ò¸ü»»¹Ì¼þµÄ°æ±¾¡£" & vbCrLf & "Äã¿ÉÒÔÔÚÏà¹ØµÄÈºÖÐÕÒµ½¹Ì¼þ°ü£¬»òÊ¹ÓÃ¡°ÔÚÏßÏÂÔØ¡±¡£" & vbCrLf & "¹Ì¼þ°æ±¾ÐèÒªÐ¡ÓÚµÈÓÚÃÜÔ¿°æ±¾¡£"
    End If
    Labels(3).Caption = "¹Ì¼þ°ü£º"
    '----
    cbFirmware.Clear
    cbFirmware.Text = "¼ÓÔØÖÐ ..."
    Dim FirmwareVersionArr() As String
    If AlwaysUseCloudFlare = "Never" Then
        FirmwareVersionArr = Split(Replace(Replace(Join(Filter(Split(Replace(Replace(GetDataStr2("https://archive.org/download/nintendo-switch-global-firmwares/nintendo-switch-global-firmwares_files.xml"), Chr(34), ""), " ", ""), vbLf), ".zip"), vbCrLf), "<filename=Firmware", ""), ".zipsource=original>", ""), vbCrLf)
    Else
        FirmwareVersionArr = Split(Replace(Replace(Join(Filter(Split(Replace(Replace(GetDataStr2(CloudFlareReverseProxyUrl & "/https://archive.org/download/nintendo-switch-global-firmwares/nintendo-switch-global-firmwares_files.xml"), Chr(34), ""), " ", ""), vbLf), ".zip"), vbCrLf), "<filename=Firmware", ""), ".zipsource=original>", ""), vbCrLf)
    End If
    Dim I As Integer
    For I = 0 To (UBound(FirmwareVersionArr) - LBound(FirmwareVersionArr))
        cbFirmware.AddItem FirmwareVersionArr(I)
    Next
    cbFirmware.Text = "Ñ¡Ôñ¹Ì¼þ°æ±¾"
End Sub

Private Sub Step4()
    Dim fso As Object, folder As Object
    Set fso = CreateObject("scripting.filesystemobject")    '´´½¨FSO¶ÔÏó
    'dependencies

    On Error Resume Next
    'µÚËÄ²½£¨¿ªÊ¼°²×°£©
    If InstallMode = 1 Or InstallMode = 3 Then
        'ÉÏÒ»²½½á¹û
        If cbFirmware.Text = "Ñ¡Ôñ¹Ì¼þ°æ±¾" Then Exit Sub
        If opFirmware(0).Value Then
            If txtFirmware.Text = "<Çëµã»÷¡°ä¯ÀÀ¡±£¬Ö®ºóÔÚÏÂ·½Ñ¡Ôñ°æ±¾ºÅ>" Or txtFirmware.Text = "" Then Exit Sub
            iFirmwareOnline = False
            iFirmwareVersion = cbFirmware.Text
            iFirmwarePath = txtFirmware.Text
        Else
            iFirmwareOnline = True
            iFirmwareVersion = cbFirmware.Text
            If DownloadSource = "GitHub" Then
                If AlwaysUseCloudFlare = "Never" Then
                    iFirmwarePath = "https://archive.org/download/nintendo-switch-global-firmwares/Firmware " & cbFirmware.Text & ".zip"
                Else
                    iFirmwarePath = CloudFlareReverseProxyUrl & "/https://archive.org/download/nintendo-switch-global-firmwares/Firmware " & cbFirmware.Text & ".zip"
                End If
            Else
                iFirmwarePath = "https://" & AliyundriveDomain & "/NSFirmwareMirror/Firmware_" & cbFirmware.Text & ".zip"
            End If
            'Legacy reverse proxy for testing purpose, uncomment it when new reverse proxy is not work
            'iFirmwarePath = "https://download.sydzy.workers.dev/api/download?url=https://archive.org/download/nintendo-switch-global-firmwares/Firmware " & cbFirmware.Text & ".zip"
        End If
    ElseIf InstallMode = 2 Then
        iBranch = ImageCombo1.Text
        If DownloadSource = "GitHub" Then
            If txtVersion.Text = "¼ÓÔØÖÐ ..." Then Exit Sub
            iVersion = txtVersion.Text
        Else
            If ComboVersion.Text = "¼ÓÔØÖÐ ..." Then Exit Sub
            iVersion = ComboVersion.Text
        End If
        'ÉèÖÃµÚÒ»²½½á¹û
    End If

    CurrentStep = 4
    '½çÃæ
    ImageCombo1.Visible = False
    Image2.Visible = False
    txtVersion.Visible = False
    ComboVersion.Visible = False
    btnVersionHelp.Visible = False
    cbFirmware.Visible = False
    txtFirmware.Visible = False
    opFirmware(0).Visible = False
    opFirmware(1).Visible = False
    Labels(3).Visible = False
    btnNextStep.Visible = False
    btnBrowse.Visible = False
    Labels(4).Visible = True
    Labels(5).Visible = True

    Labels(2).Caption = "Õâ¿ÉÄÜÐèÒªÊ®¼¸·ÖÖÓ£¬Äã¿ÉÒÔ×øÏÂÀ´ºÈ±­²è¡£" & vbCrLf & "¸ù¾ÝÍøÂç×´¿öºÍµçÄÔÐÔÄÜ£¬°²×°ËÙ¶È»áÓÐËù²»Í¬¡£"
    If InstallMode = 1 Then
        Me.Caption = "°²×° Ryujinx - ÕýÔÚ°²×°"
        Labels(1).Caption = "ÕýÔÚ°²×° Ryujinx " & iBranch & " " & iVersion & " ..."
    ElseIf InstallMode = 2 Then
        Me.Caption = "¸üÐÂ Ryujinx - ÕýÔÚ°²×°"
        Labels(1).Caption = "ÕýÔÚ¸üÐÂ Ryujinx µ½ " & iBranch & " " & iVersion & " ..."
    ElseIf InstallMode = 3 Then
        Me.Caption = "¸üÐÂ¹Ì¼þ - ÕýÔÚ°²×°"
        Labels(1).Caption = "ÕýÔÚ°²×°¹Ì¼þ ..."
        GoTo FirmwareInstallation
    End If

    'Éú³ÉÄ£ÄâÆ÷ÏÂÔØÁ´½Ó
    DoEvents
    Labels(4).Caption = "×¼±¸°²×° ..."
    Labels(5).Caption = ""
    iVersion = CStr(CInt(iVersion))
    Dim RyujinxUrl As String
    Select Case iBranch
    Case "Ö÷Ïß°æ"
        'Ö÷Ïß
        If DownloadSource = "GitHub" Then
            RyujinxUrl = "https://github.com/Ryujinx/release-channel-master/releases/download/" & iVersion & "/ryujinx-" & iVersion & "-win_x64.zip"
        Else
            RyujinxUrl = "https://" & AliyundriveDomain & "/RyujinxMainlineMirror/ryujinx-" & iVersion & "-win_x64.zip"
        End If
    Case "LDNÁª»ú°æ"
        'LDN
        RyujinxUrl = "https://" & AliyundriveDomain & "/RyujinxLDNMirror/ryujinx-" & iVersion & "-win_x64.zip"
    Case "ÖÐÎÄ°æ"
    Debug.Print "ºº»¯"
        'ºº»¯
        If DownloadSource = "GitHub" Then
            RyujinxUrl = "https://github.com/YidaozhanYa/RyujinxCN/releases/download/" & iVersion & "/ryujinx-cn-" & iVersion & "-win_x64.zip"
        Else
            RyujinxUrl = "https://" & AliyundriveDomain & "/RyujinxCNBuilds/ryujinx-cn-" & iVersion & "-win_x64.zip"
        End If
    Case "Vulkan"
        'Vulkan
        If DownloadSource = "GitHub" Then
            RyujinxUrl = "https://github.com/YidaozhanYa/RyujinxCN/releases/download/" & iVersion & "/ryujinx-cn-vulkan-" & iVersion & "-win_x64.zip"
        Else
            RyujinxUrl = "https://" & AliyundriveDomain & "/RyujinxCNVulkanBuilds/ryujinx-cn-vulkan-" & iVersion & "-win_x64.zip"
        End If
    End Select

    If CheckFileExists(RyujinxInstallFolder & "\Ryujinx.zip") = False Then
        If iBranch <> "LDNÁª»ú°æ" Then
            If DownloadSource = "GitHub" Then
                If AlwaysUseCloudFlare = "False" Then
                    DoEvents
                    'githubÁ¬Í¨ÐÔ²âÊÔ
                    Labels(4).Caption = "ÕýÔÚ²âÊÔ GitHub Á¬Í¨ÐÔ ..."
                    Labels(5).Caption = "Èç¹û GitHub ²»ÄÜÁ¬Í¨£¬¾ÍÊ¹ÓÃ CloudFlare Workers¡£"
                    Dim Tmp As String
                    Tmp = "timeout"
                    Inet1.Cancel
                    Inet1.Protocol = icHTTPS
                    Inet1.Url = "https://github.com/opensearch.xml"
                    Inet1.RequestTimeout = 10
                    Tmp = Inet1.OpenURL
                    If Err.Number = 35761 Then
                        Labels(4).Caption = "ÕýÔÚÏÂÔØÄ£ÄâÆ÷£¬Ê¹ÓÃ CloudFlare Workers ..."
                        RyujinxUrl = CloudFlareReverseProxyUrl & "\" & RyujinxUrl
                    Else
                        If InStr(Tmp, "OpenSearchDescription") = 2 Then
                            Labels(4).Caption = "ÕýÔÚÏÂÔØÄ£ÄâÆ÷£¬Ê¹ÓÃ GitHub ..."
                        Else
                            Labels(4).Caption = "ÕýÔÚÏÂÔØÄ£ÄâÆ÷£¬Ê¹ÓÃ CloudFlare Workers ..."
                            RyujinxUrl = CloudFlareReverseProxyUrl & "\" & RyujinxUrl
                        End If
                    End If
                    Labels(5).Caption = "×¼±¸ÏÂÔØ ..."
                ElseIf AlwaysUseCloudFlare = "False" Then
                    RyujinxUrl = RyujinxUrl
                Else
                    RyujinxUrl = CloudFlareReverseProxyUrl & "\" & RyujinxUrl
                End If
            Else
                Labels(4).Caption = "ÕýÔÚÏÂÔØÄ£ÄâÆ÷ ..."
            End If
        End If
    End If

    DoEvents
    'ÏÂÔØÄ£ÄâÆ÷
    If CheckFileExists(RyujinxInstallFolder & "\Ryujinx.zip") = False Then
ReDownload:
        PBar.Visible = True
        PBar.Value = 0
        AsyncReads(0) = RyujinxUrl
        AsyncReads(1) = RyujinxInstallFolder & "\Ryujinx.zip"
        ucDownload1.DownloadFile AsyncReads(0), AsyncReads(1)
        DoEvents
        DownloadCompleted = False
        Do Until DownloadCompleted
            Sleep 100
            DoEvents
        Loop
        Sleep 2000
        DoEvents
        PBar.Visible = False
        If CheckFileExists(RyujinxInstallFolder & "\Ryujinx.zip") = False Then
            Sleep 1000
            Sleep 1000
            Sleep 1000
            Sleep 1000
            Sleep 1000
            GoTo ReDownload
        End If
    End If

FirmwareInstallation:
    If InstallMode = 1 Or InstallMode = 3 Then
        'ÏÂÔØ¹Ì¼þ
        DoEvents
        If CheckFileExists(RyujinxInstallFolder & "\Firmware.zip") = False Then
            If iFirmwareOnline Then
ReDownload2:
                Labels(4).Caption = "ÕýÔÚÏÂÔØ¹Ì¼þ£¬ÇëÄÍÐÄµÈ´ý ..."
                Labels(5).Caption = "×¼±¸ÏÂÔØ ..."
                PBar.Visible = True
                PBar.Value = 0
                DoEvents
                AsyncReads(0) = iFirmwarePath
                AsyncReads(1) = RyujinxInstallFolder & "\Firmware.zip"
                ucDownload1.DownloadFile AsyncReads(0), AsyncReads(1)
                DoEvents
                DownloadCompleted = False
                Do Until DownloadCompleted
                    Sleep 100
                    DoEvents
                Loop
                Sleep 2000
                DoEvents
                PBar.Visible = False
                DoEvents
                If CheckFileExists(RyujinxInstallFolder & "\Firmware.zip") = False Then
                    Sleep 1000
                    Sleep 1000
                    Sleep 1000
                    Sleep 1000
                    Sleep 1000
                    GoTo ReDownload2
                End If
            Else
                Labels(4).Caption = "ÕýÔÚ¼ÓÔØ ..."
                Labels(5).Caption = ""
                PBar.Visible = False
                DoEvents
            End If
        End If
    End If

    If InstallMode = 1 Or InstallMode = 2 Then
ReInstall:
        'É¾³ý¾É°æ±¾
        If InstallMode = 2 Then
            Labels(4).Caption = "ÕýÔÚÉ¾³ýÖ®Ç°µÄÄ£ÄâÆ÷ ..."
            Labels(5).Caption = ""
            DoEvents
            Shell "cmd /c rd /s /q " & Chr(34) & RyujinxInstallFolder & "\bin" & Chr(34)
            DoEvents
            Shell "cmd /c rd /s /q " & Chr(34) & RyujinxInstallFolder & "\etc" & Chr(34)
            DoEvents
            Shell "cmd /c rd /s /q " & Chr(34) & RyujinxInstallFolder & "\lib" & Chr(34)
            DoEvents
            Shell "cmd /c rd /s /q " & Chr(34) & RyujinxInstallFolder & "\Logs" & Chr(34)
            DoEvents
            Shell "cmd /c rd /s /q " & Chr(34) & RyujinxInstallFolder & "\share" & Chr(34)
            DoEvents
            Shell "cmd /c del /s /q " & Chr(34) & RyujinxInstallFolder & "\*.dll" & Chr(34)
            DoEvents
            Shell "cmd /c del /s /q " & Chr(34) & RyujinxInstallFolder & "\*.so" & Chr(34)
            Shell "cmd /c del /s /q " & Chr(34) & RyujinxInstallFolder & "\*.dylib" & Chr(34)
            DoEvents
            Shell "cmd /c del /s /q " & Chr(34) & RyujinxInstallFolder & "\*.pdb" & Chr(34)
            Shell "cmd /c del /s /q " & Chr(34) & RyujinxInstallFolder & "\*.config" & Chr(34)
            DoEvents
            Shell "cmd /c del /s /q " & Chr(34) & RyujinxInstallFolder & "\alsoft.ini" & Chr(34)
            Shell "cmd /c del /s /q " & Chr(34) & RyujinxInstallFolder & "\*.exe" & Chr(34)
            DoEvents
        End If
        '°²×°Ä£ÄâÆ÷ ½âÑ¹
        Labels(4).Caption = "ÕýÔÚ½âÑ¹ËõÄ£ÄâÆ÷ ..."
        Labels(5).Caption = ""
        PBar.Visible = True
        PBar.Value = 50
        DoEvents
        Unzip RyujinxInstallFolder & "\Ryujinx.zip", RyujinxInstallFolder
        PBar.Visible = False
        DoEvents
        Labels(4).Caption = "ÕýÔÚ°²×°Ä£ÄâÆ÷ ..."
        '¸´ÖÆÎÄ¼þ
        DoEvents
        XCopy RyujinxInstallFolder & "\publish", RyujinxInstallFolder
        Shell "cmd /c rd /s /q " & Chr(34) & RyujinxInstallFolder & "\publish" & Chr(34), vbHide
        DoEvents
        ''''''''''''
        Sleep 1000
        If CheckFileExists(RyujinxInstallFolder & "\Ryujinx.exe") = False Then
            Labels(5).Caption = "½âÑ¹Ê§°Ü£¬ÕýÔÚÖØÐÂ½âÑ¹ ..."
            GoTo ReInstall
        End If
    End If

    If InstallMode = 1 Then
        '°²×°ÃÜÔ¿
        Labels(4).Caption = "ÕýÔÚ°²×°ÃÜÔ¿ ..."
        DoEvents
        MkDirs RyujinxInstallFolder & "\portable\system"
        FileCopy iKeyPath, RyujinxInstallFolder & "\portable\system\prod.keys"
    End If

    If InstallMode = 1 Or InstallMode = 3 Then
        If InstallMode = 3 Then
            Labels(4).Caption = "ÕýÔÚÉ¾³ý¾É¹Ì¼þ ..."
            DoEvents
            Shell "cmd /c rd /s /q " & Chr(34) & RyujinxInstallFolder & "\portable\bis\system\Contents" & Chr(34), vbMinimizedNoFocus
            Sleep 10000
        End If
        '°²×°¹Ì¼þ
        'ÎÄ¼þ¼Ð
        Labels(4).Caption = "ÕýÔÚ½âÑ¹Ëõ²¢°²×°¹Ì¼þ°ü ..."
        DoEvents
        MkDirs RyujinxInstallFolder & "\portable\bis\system\Contents\registered"
        MkDirs RyujinxInstallFolder & "\FWTMP"
        DoEvents
        '½âÑ¹
        PBar.Visible = True
        PBar.Value = 75
        DoEvents
        If iFirmwareOnline Then
            Unzip RyujinxInstallFolder & "\Firmware.zip", RyujinxInstallFolder & "\FWTMP"
        Else
            Unzip iFirmwarePath, RyujinxInstallFolder & "\FWTMP"
        End If
        PBar.Visible = False
        DoEvents
        'Ryujinx¹Ì¼þ°²×°
        Dim FileName() As String
        Dim file As Object
        Set folder = fso.GetFolder(RyujinxInstallFolder & "\FWTMP")
        For Each file In folder.Files    '±éÀú¸ùÎÄ¼þ¼ÐÏÂµÄÎÄ¼þ
            DoEvents
            MkDir RyujinxInstallFolder & "\portable\bis\system\Contents\registered\" & Replace(Replace(file, RyujinxInstallFolder & "\FWTMP", ""), ".cnmt", "")
            FileCopy file, RyujinxInstallFolder & "\portable\bis\system\Contents\registered\" & Replace(Replace(file, RyujinxInstallFolder & "\FWTMP", ""), ".cnmt", "") & "\00"
        Next
        'É¾³ýÁÙÊ±ÎÄ¼þ
        Shell "cmd /c rd /s /q " & Chr(34) & RyujinxInstallFolder & "\FWTMP" & Chr(34), vbMinimizedNoFocus
    End If

    'Éú³É ini ºÍÅäÖÃ
    If InstallMode = 1 Then
        RyujinxVersion = iVersion
        RyujinxBranch = iBranch
        RyujinxFirmware = iFirmwareVersion
        WriteIni "Ryujinx", "Version", RyujinxVersion, RyujinxInstallFolder & "\RyujinxConfig.ini"
        WriteIni "Ryujinx", "Branch", RyujinxBranch, RyujinxInstallFolder & "\RyujinxConfig.ini"
        WriteIni "Ryujinx", "Firmware", RyujinxFirmware, RyujinxInstallFolder & "\RyujinxConfig.ini"
        MkDirs RyujinxInstallFolder & "\portable\bis\user\save"
        RyujinxCustomDataFolder = "False"
        WriteIni "Ryujinx", "CustomDataFolder", RyujinxCustomDataFolder, RyujinxInstallFolder & "\RyujinxConfig.ini"
    ElseIf InstallMode = 2 Then
        RyujinxVersion = iVersion
        RyujinxBranch = iBranch
        WriteIni "Ryujinx", "Version", RyujinxVersion, RyujinxInstallFolder & "\RyujinxConfig.ini"
        WriteIni "Ryujinx", "Branch", RyujinxBranch, RyujinxInstallFolder & "\RyujinxConfig.ini"
    ElseIf InstallMode = 3 Then
        RyujinxFirmware = iFirmwareVersion
        WriteIni "Ryujinx", "Firmware", RyujinxFirmware, RyujinxInstallFolder & "\RyujinxConfig.ini"
    End If

    'Íê³É
    If InstallMode = 1 Or InstallMode = 2 Then
        Labels(1).Caption = "Ryujinx " & iBranch & " " & iVersion & " °²×°Íê³É£¡"
    ElseIf InstallMode = 3 Then
        Labels(1).Caption = "Ryujinx ¹Ì¼þ " & iFirmwareVersion & " °²×°Íê³É£¡"
    End If
    Labels(2).Caption = "ÊÇ·ñÒªÉ¾³ý°²×°¹ý³ÌÖÐ²úÉúµÄÁÙÊ±ÎÄ¼þ£¿"
    Labels(4).Visible = False
    Labels(5).Visible = False
    btnDelYes.Visible = True
    btnDelNo.Visible = True
    'ÊÍ·ÅÄÚ´æ
    Set fso = Nothing
    Set folder = Nothing
    Set file = Nothing
    If InstallMode = 1 Then
        btnShortcut.Visible = True
    End If

End Sub

Private Sub btnDelNo_Click()
    Unload Me
End Sub

Private Sub btnDelYes_Click()
    RemoveTemps
    Unload Me
End Sub

Private Sub RemoveTemps()
    On Error Resume Next
    Kill RyujinxInstallFolder & "\Ryujinx.zip"
    Kill RyujinxInstallFolder & "\Firmware.zip"
End Sub

Private Sub Form_Unload(Cancel As Integer)
    If InstallMode = 1 Then
        frmMain.Show
    Else
        frmManage.Show
    End If
End Sub

Private Sub opFirmware_Click(Index As Integer)
'ÇÐ»»¹Ì¼þÏÂÔØ·½Ê½
    Dim FirmwareVersionArr() As String
    Dim I As Integer
    If Index = 1 Then
        'ÔÚÏß
        txtFirmware.Visible = False
        btnBrowse.Visible = False
        cbFirmware.Top = 2520
        txtVersion.Visible = False
        cbFirmware.Clear
        cbFirmware.Text = "¼ÓÔØÖÐ ..."
        FirmwareVersionArr = Filter(Split(GetDataStr2("https://" & AliyundriveDomain & "/NSFirmwareMirror/?json"), Chr(34)), "firmware_")
        For I = 0 To (UBound(FirmwareVersionArr) - LBound(FirmwareVersionArr))
            cbFirmware.AddItem Replace(Replace(FirmwareVersionArr(I), "firmware_", ""), ".zip", "")
        Next
        cbFirmware.Text = "Ñ¡Ôñ¹Ì¼þ°æ±¾"
    Else
        '±¾µØ
        txtFirmware.Visible = True
        btnBrowse.Visible = True
        cbFirmware.Top = 3120
        cbFirmware.Clear
        cbFirmware.Text = "¼ÓÔØÖÐ ..."
        If AlwaysUseCloudFlare = "Never" Then
            FirmwareVersionArr = Split(Replace(Replace(Join(Filter(Split(Replace(Replace(GetDataStr2("https://archive.org/download/nintendo-switch-global-firmwares/nintendo-switch-global-firmwares_files.xml"), Chr(34), ""), " ", ""), vbLf), ".zip"), vbCrLf), "<filename=Firmware", ""), ".zipsource=original>", ""), vbCrLf)
        Else
            FirmwareVersionArr = Split(Replace(Replace(Join(Filter(Split(Replace(Replace(GetDataStr2(CloudFlareReverseProxyUrl & "/https://archive.org/download/nintendo-switch-global-firmwares/nintendo-switch-global-firmwares_files.xml"), Chr(34), ""), " ", ""), vbLf), ".zip"), vbCrLf), "<filename=Firmware", ""), ".zipsource=original>", ""), vbCrLf)
        End If
        For I = 0 To (UBound(FirmwareVersionArr) - LBound(FirmwareVersionArr))
            cbFirmware.AddItem FirmwareVersionArr(I)
        Next
        cbFirmware.Text = "Ñ¡Ôñ¹Ì¼þ°æ±¾"
    End If

End Sub

Private Sub ucDownload1_DownloadProgress(ByVal BytesRead As Long, ByVal BytesTotal As Long)
'Ë¢ÐÂ½ø¶ÈÌõ
    Labels(5).Caption = Format(BytesRead / BytesTotal, "Percent") & " " & CStr(FormatNumber(BytesRead / 1048576, 2, vbTrue)) & "MB / " & CStr(FormatNumber(BytesTotal / 1048576, 2, vbTrue)) & "MB"
    PBar.Value = CInt(BytesRead / BytesTotal * 100)
End Sub

Private Sub ucDownload1_DownloadFailed(ByVal Status As String, ByVal StatusCode As AsyncStatusCodeConstants)
' Visual Basic, F**K YOU!!!
' ¸É·¹Íõ, F**K YOU!!!
    Labels(5).Caption = "ÏÂÔØÊ§°Ü£¬ÕýÔÚ³¢ÊÔÊ¹ÓÃ±¸ÓÃÏÂÔØ ..."
    DoEvents
    ShellAndWait Chr(34) & App.Path & "\Dependencies\curl.exe" & Chr(34) & " -fkL " & Chr(34) & AsyncReads(0) & Chr(34) & " -o " & Chr(34) & AsyncReads(1) & Chr(34)
    DoEvents
    Labels(5).Caption = "±¸ÓÃÏÂÔØ³É¹¦£¡"
    DoEvents
    DownloadCompleted = True
End Sub

Private Sub ucDownload1_DownloadComplete()
    DownloadCompleted = True
End Sub


Private Sub ImageCombo1_Click()
    If ImageCombo1.Text = "LDNÁª»ú°æ" Then
        Image1.Picture = ImageList2.ListImages(2).Picture
        Image2.Picture = ImageList2.ListImages(2).Picture
    Else
        Image1.Picture = ImageList2.ListImages(1).Picture
        Image2.Picture = ImageList2.ListImages(1).Picture
    End If
    Dim RyujinxVersion() As String
    Dim I As Integer
    Select Case ImageCombo1.Text
    Case "Ö÷Ïß°æ"
        If DownloadSource = "GitHub" Then
            txtVersion.Visible = True
            ComboVersion.Visible = False
            txtVersion.Text = GetRyujinxVersion
            txtVersion.SetFocus
        Else
            txtVersion.Visible = False
            ComboVersion.Visible = True
            ComboVersion.Clear
            ComboVersion.Text = "¼ÓÔØÖÐ ..."
            RyujinxVersion = Split(GetRyujinxVersionAli, vbCrLf)
            For I = 0 To (UBound(RyujinxVersion) - LBound(RyujinxVersion))
                ComboVersion.AddItem RyujinxVersion(I)
                ComboVersion.Text = RyujinxVersion(I)
                ComboVersion.SetFocus
            Next
        End If
    Case "ÖÐÎÄ°æ"
        If DownloadSource = "GitHub" Then
            txtVersion.Visible = True
            ComboVersion.Visible = False
            txtVersion.Text = GetRyujinxCNVersion
            txtVersion.SetFocus
        Else
            txtVersion.Visible = False
            ComboVersion.Visible = True
            ComboVersion.Clear
            ComboVersion.Text = "¼ÓÔØÖÐ ..."
            RyujinxVersion = Split(GetRyujinxCNVersionAli, vbCrLf)
            For I = 0 To (UBound(RyujinxVersion) - LBound(RyujinxVersion))
                ComboVersion.AddItem RyujinxVersion(I)
                ComboVersion.Text = RyujinxVersion(I)
                ComboVersion.SetFocus
            Next
        End If
    Case "LDNÁª»ú°æ"
        txtVersion.Visible = False
        ComboVersion.Visible = True
        ComboVersion.Clear
        ComboVersion.Text = "¼ÓÔØÖÐ ..."
        RyujinxVersion = Split(GetRyujinxLDNVersionAli, vbCrLf)
        For I = 0 To (UBound(RyujinxVersion) - LBound(RyujinxVersion))
            ComboVersion.AddItem RyujinxVersion(I)
            ComboVersion.Text = RyujinxVersion(I)
            ComboVersion.SetFocus
        Next
    Case "Vulkan"
        If DownloadSource = "GitHub" Then
            txtVersion.Visible = True
            ComboVersion.Visible = False
            txtVersion.Text = GetRyujinxCNVersion
            txtVersion.SetFocus
        Else
            txtVersion.Visible = False
            ComboVersion.Visible = True
            ComboVersion.Clear
            ComboVersion.Text = "¼ÓÔØÖÐ ..."
            RyujinxVersion = Split(GetRyujinxVulkanVersionAli, vbCrLf)
            For I = 0 To (UBound(RyujinxVersion) - LBound(RyujinxVersion))
                ComboVersion.AddItem RyujinxVersion(I)
                ComboVersion.Text = RyujinxVersion(I)
                ComboVersion.SetFocus
            Next
        End If
    End Select
End Sub

Private Sub Form_Initialize()
    InitCommonControls
End Sub

Private Sub ImageCombo1_KeyPress(KeyAscii As Integer)
KeyAscii = 0
End Sub

Private Sub cbFirmware_KeyPress(KeyAscii As Integer)
KeyAscii = 0
End Sub


Private Sub ComboVersion_KeyPress(KeyAscii As Integer)
KeyAscii = 0
End Sub
Private Sub txtVersion_KeyPress(KeyAscii As Integer)
'Ö»ÄÜÊäÈëÊý×Ö
    If KeyAscii = 8 Then Exit Sub
    If KeyAscii < 48 Or KeyAscii > 57 Then KeyAscii = 0
    If Len(txtVersion.Text) >= 4 Then KeyAscii = 0
End Sub


